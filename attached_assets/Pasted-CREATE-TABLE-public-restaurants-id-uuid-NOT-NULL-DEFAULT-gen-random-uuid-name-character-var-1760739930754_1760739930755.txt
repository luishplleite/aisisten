CREATE TABLE public.restaurants (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  owner_id uuid,
  owner_name character varying NOT NULL,
  owner_cpf character varying,
  owner_phone character varying NOT NULL,
  cnpj character varying,
  business_type character varying,
  address text NOT NULL,
  city character varying NOT NULL,
  state character varying NOT NULL,
  zip_code character varying NOT NULL,
  primary_color character varying DEFAULT '#28a745'::character varying,
  logo_url text,
  delivery_retun numeric DEFAULT 5.00 CHECK (delivery_retun >= 0::numeric),
  minimum_delivery_fee numeric DEFAULT 8.00 CHECK (minimum_delivery_fee >= 0::numeric),
  delivery_fee_per_km numeric DEFAULT 2.50 CHECK (delivery_fee_per_km >= 0::numeric),
  minimum_distance_km numeric DEFAULT 3.0 CHECK (minimum_distance_km > 0::numeric),
  preparation_time integer DEFAULT 30 CHECK (preparation_time > 0),
  delivery_radius numeric DEFAULT 10.0 CHECK (delivery_radius > 0::numeric),
  minimum_order numeric DEFAULT 0.00 CHECK (minimum_order >= 0::numeric),
  business_hours jsonb DEFAULT '{"friday": {"open": "08:00", "close": "18:00", "closed": false}, "monday": {"open": "08:00", "close": "18:00", "closed": false}, "sunday": {"open": "08:00", "close": "18:00", "closed": true}, "tuesday": {"open": "08:00", "close": "18:00", "closed": false}, "saturday": {"open": "08:00", "close": "18:00", "closed": false}, "thursday": {"open": "08:00", "close": "18:00", "closed": false}, "wednesday": {"open": "08:00", "close": "18:00", "closed": false}}'::jsonb,
  notification_settings jsonb DEFAULT '{"email": {"new_order": false, "daily_report": false}, "sound": {"new_order": true, "order_update": false}}'::jsonb,
  asaas_config jsonb DEFAULT '{}'::jsonb,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying::text, 'inactive'::character varying::text, 'suspended'::character varying::text])),
  plan character varying DEFAULT 'basic'::character varying CHECK (plan::text = ANY (ARRAY['basic'::character varying::text, 'premium'::character varying::text, 'enterprise'::character varying::text])),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  latitude numeric,
  longitude numeric,
  pedidos_online boolean,
  link_cardapio text,
  payment_methods jsonb DEFAULT '{"pix": {"key": null, "enabled": false}, "card": {"debit": false, "credit": false, "enabled": false}, "cash": {"enabled": true, "needs_change": false}}'::jsonb,
  whatsapp_config jsonb DEFAULT '{"api_key": null, "enabled": false, "phone_number": null}'::jsonb,
  smtp_config jsonb DEFAULT '{"host": null, "port": null, "enabled": false, "password": null, "username": null}'::jsonb,
  api_assas text,
  trial_enabled boolean DEFAULT true,
  trial_start_date timestamp with time zone DEFAULT now(),
  trial_end_date timestamp with time zone DEFAULT (now() + '7 days'::interval),
  trial_days_remaining integer DEFAULT 7,
  subscription_status character varying DEFAULT 'trial'::character varying CHECK (subscription_status::text = ANY (ARRAY['trial'::character varying, 'active'::character varying, 'expired'::character varying, 'cancelled'::character varying]::text[])),
  subscription_start_date text,
  subscription_end_date text,
  subscription_days_remaining integer DEFAULT 30,
  whatsapp_disconnected_due_to_trial boolean DEFAULT false,
  operating_hours jsonb DEFAULT '{"friday": {"is_open": true, "open_time": "08:00", "close_time": "18:00"}, "monday": {"is_open": true, "open_time": "08:00", "close_time": "18:00"}, "sunday": {"is_open": false, "open_time": null, "close_time": null}, "tuesday": {"is_open": true, "open_time": "08:00", "close_time": "18:00"}, "saturday": {"is_open": true, "open_time": "08:00", "close_time": "18:00"}, "thursday": {"is_open": true, "open_time": "08:00", "close_time": "18:00"}, "wednesday": {"is_open": true, "open_time": "08:00", "close_time": "18:00"}}'::jsonb,
  owner_email character varying,
  trial_extension_reason text,
  manual_activation_reason text,
  status_change_reason text,
  third_party_delivery_enabled boolean DEFAULT false,
  house_delivery_enabled boolean DEFAULT false,
  house_minimum_delivery_fee numeric DEFAULT 5.00 CHECK (house_minimum_delivery_fee >= 0::numeric),
  house_delivery_fee_per_km numeric DEFAULT 2.00 CHECK (house_delivery_fee_per_km >= 0::numeric),
  house_minimum_distance_km numeric DEFAULT 2.0 CHECK (house_minimum_distance_km > 0::numeric),
  house_delivery_radius numeric DEFAULT 8.0 CHECK (house_delivery_radius > 0::numeric),
  CONSTRAINT restaurants_pkey PRIMARY KEY (id)
);